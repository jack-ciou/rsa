# 比特幣交易簽章教學詳解

## 程序運行結果分析

### 第一步：密鑰初始化
- **私鑰**: `e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855`
  - 這是一個256位（32字節）的隨機數，是比特幣地址的根源
  - 私鑰必須保密，任何擁有私鑰的人都可以花費相應的比特幣

- **公鑰**: `03a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd`
  - 通過橢圓曲線數學從私鑰派生而來
  - 公鑰可以安全地公開分享
  - 前綴`03`表示這是壓縮格式的公鑰

- **地址**: `1F3sAm6ZtwLAUnj7d38pGFxtP3RVEvtsbV`
  - 這是P2PKH（Pay-to-Public-Key-Hash）地址
  - 從公鑰通過雜湊運算得出
  - 以`1`開頭表示主網上的Legacy地址

### 第二步：交易構建
- **輸入（UTXO）**: 
  - 交易ID: `d9d889499d84cc5aa7e200ee84c81fb10b3747167878b18a77cdc794ccfc29ec`
  - 輸出索引: `0`
  - 金額: `100000000` satoshis (1 BTC)

- **輸出**:
  - 目標地址: `1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa` (創世區塊地址)
  - 金額: `99000000` satoshis (0.99 BTC)
  - 手續費: `1000000` satoshis (0.01 BTC)

### 第三步：交易簽章
- **未簽章交易**: `0200000001ec29fccc94c7cd778ab178781647370bb11fc884ee00e2a75acc849d4989d8d90000000000ffffffff01c09ee605000000001976a91462e907b15cbf27d5425399ebf6f0fb50ebb88f1888ac00000000`

- **最終簽章交易**: `0200000001ec29fccc94c7cd778ab178781647370bb11fc884ee00e2a75acc849d4989d8d9000000006a4730440220126ad3d031f24bd8a4bcf7a4e8ce9450883cda37d6f05c9ad61f4c2ab3cb09b702203f9debad3a56ad494639b6221234a077aaf4a694cb78e7c2b784515a530eed2d012103a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bdffffffff01c09ee605000000001976a91462e907b15cbf27d5425399ebf6f0fb50ebb88f1888ac00000000`

- **交易ID**: `69febc26135236cdd9b75ee1e3e54579bb86486c13c0cf3cadc0ab6a1f01eeac`

## 交易結構詳細解析

### 解鎖腳本（ScriptSig）分析
```
4730440220126ad3d031f24bd8a4bcf7a4e8ce9450883cda37d6f05c9ad61f4c2ab3cb09b702203f9debad3a56ad494639b6221234a077aaf4a694cb78e7c2b784515a530eed2d012103a34b99f22c790c4e36b2b3c2c35a36db06226e41c692fc82b8b56ac1c540c5bd
```

拆解如下：
- `47`: 簽章長度（71字節）
- `30440220...2d01`: DER編碼的ECDSA簽章 + SIGHASH_ALL標記
- `21`: 公鑰長度（33字節）
- `03a34b99...c5bd`: 壓縮格式公鑰

### ECDSA簽章詳解
ECDSA簽章使用以下步驟：
1. 計算交易雜湊（要簽章的數據）
2. 使用私鑰對雜湊進行簽章
3. 生成(r, s)簽章對
4. 添加SIGHASH類型標記

### SIGHASH類型
- `SIGHASH_ALL (0x01)`: 簽章覆蓋所有輸入和輸出
- 確保交易的完整性，任何修改都會使簽章無效

## 安全性要點

1. **私鑰安全**: 私鑰是資產控制權的唯一證明
2. **雜湊函數**: SHA-256確保數據完整性
3. **橢圓曲線**: secp256k1提供強密碼學安全性
4. **數字簽章**: ECDSA確保只有私鑰持有者能花費UTXO

## 實際應用注意事項

1. **UTXO查詢**: 實際應用需要從區塊鏈查詢真實UTXO
2. **手續費計算**: 需要根據網絡狀況估算適當手續費
3. **網絡廣播**: 簽章完成後需要廣播到比特幣網絡
4. **確認等待**: 交易需要等待礦工確認

## 教學價值

這個演示程序展示了：
- 比特幣密碼學基礎
- 交易結構和簽章機制
- UTXO模型的工作原理
- 數字簽章的實際應用

對於理解比特幣的技術原理具有重要的教學意義。
